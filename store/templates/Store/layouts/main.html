{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Last-Modified" content="0">
    <meta http-equiv="Cache-Control" content="no-cache, mustrevalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        {% block title %}
        
        {% endblock title %}
    </title>
    <script src="https://www.paypal.com/sdk/js?client-id=Af4mFXyhkQEqOQii7pDxuNDiqs6y7IHi5AC2bGLgERIhZn42jXn-H8_3kd_yQ5u05RhUHa7bAR-tlg8h&currency=USD"></script>
    <script src="{% static '/js/jquery-3.6.4.min.js' %}"></script>
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <script src="{% static '/js/custom.js' %}"></script>
    {% comment %} Alertify JS {% endcomment %}
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/alertify.min.css"/>
    <!-- Default theme -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/css/themes/default.min.css"/>
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    
   
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="{% static 'fontawesomefree/css/fontawesome.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/brands.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'fontawesomefree/css/solid.css' %}" rel="stylesheet" type="text/css">
    <link href="{% static 'css/custom.css' %}" rel="stylesheet">

    <link href="{% static 'css/owl.carousel.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/owl.theme.default.min.css' %}" rel="stylesheet">



    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">

    <style>
        body{
            background-image: url('{% static '/images/header-transformed.jpeg' %}');
            background-attachment: fixed;
            background-repeat: no-repeat;
            background-position: center center;
            background-size: cover;
        }

        a{
            text-decoration: none;
            color: #000;
        }
        .btn{
        margin-top: 1rem;
        display: inline-block;
        padding: .9rem 3rem;
        font-size: 1.7rem;
        color: #fff;
        background: var(--main-color);
        cursor: pointer;
        }
        .product-viewtag{
            background-color: red;
            color: #fff;
            font-size: 11px;
            line-height: 1;
            position: absolute;
            text-align: center;
            text-transform: uppercase;
            top: 22px;
            margin-left: 17.5rem;
            padding: 7px 10px;
            font-weight: 600;
            min-width: 45px;
        }
        .active{
            font-weight:800;
        }
        
    </style>
</head>
    <body>
        <div id="progress">
            <span id="progress-value">&#x1F815;</span>
        </div>

    {% include 'Store/inc/navbar.html' %}
    {% block content %} 

    {% endblock content %}

    <a href="https://wa.me/+56974818860?text=Estoy%20interesado%20en%20su%20producto" target="_blank" class="whatsapp-chat">
        <img src="{% static 'images/Whatsapp.png' %}" alt="whatsapp" width="70px" >
    </a>

    {% comment %} jquery {% endcomment %}

    
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8= sha256-T+aPohYXbm0fRYDpJLr+zJ9RmYTswGsahAoIsNiMld4=" crossorigin="anonymous"></script>
    {% comment %} Custom JS {% endcomment %}
    <script src="{% static '/js/flecha.js' %}"></script>
    <script src="{% static '/js/owl.carousel.min.js' %}"></script>

    {% comment %} bootstrap {% endcomment %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>

    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script>
        var availableTags = [];
        $.ajax({
            method: "GET",
            url: "/product-list",
            success: function (response){
                startAutocomplete(response);
            }
        });

        function startAutocomplete(availableTags)
        {
            $( "#searchproducts" ).autocomplete({
                source: availableTags
            });
        }
        
        </script>
        
        {% comment %} Alertify JS {% endcomment %}
        <script src="//cdn.jsdelivr.net/npm/alertifyjs@1.13.1/build/alertify.min.js"></script>

    <script>
        alertify.set('notifier','position', 'top-right');

        {% for msg in messages %}
            alertify.success('{{ msg }}'); 
        {% endfor %}
        
            
    </script>
    <script>
        $('.owl-carousel').owlCarousel({
            loop:true,
            margin:10,
            nav:true,
            responsive:{
                0:{
                    items:1
                },
                600:{
                    items:3
                },
                1000:{
                    items:4
                }
            }
        })
    </script>
    <script>
        paypal.Buttons({
            onclick : function(data, actions) {
                var fname = $("[name='fname']").val();
                var lname = $("[name='lname']").val();
                var email = $("[name='email']").val();
                var phone = $("[name='phone']").val();
                var address = $("[name='address']").val();
                var city = $("[name='city']").val();
                var state = $("[name='state']").val();
                var country = $("[name='country']").val();
                var pincode = $("[name='picode']").val();
                var token = $("[name='csrfmiddlewaretoken']").val();

                if(fname == "" || lname == "" || email == "" || phone == "" || address == "" || city == "" || state == "" || country == "" || pincode == "" || token == "")
                {
                    swal("Alerta!", "Todos los campos son obligatorios!", "error");
                    return false;
                }
                else
                {
                    return true;
                }
            },
            // Order is created on the server and the order id is returned
            createOrder: function(data, actions) {
                return actions.order.create( {
                        purchase_units: [{
                            amount: {
                                value:  '0.01', //'{{ total_price | stringformat:'d' }}'
                            }
                        }]
                    });
                },     
                // Finalize the transaction on the server after payer approval
                onApprove: function(data, actions) {
                    return actions.order.capture().then(function(orderData){
                            // Successful capture! For dev/demo purposes:
                            //console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                            //alert(orderData.id);
                            //var transaction = orderData.purchase_units[0].payments.captures[0];
                            //alert('Transaction '+ transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');
                            // When ready to go live, remove the alert and show a success message within this page. For example:
                            // const element = document.getElementById('paypal-button-container');
                            // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                            // Or go to another URL:  window.location.href = 'thank_you.html';
                            var fname = $("[name='fname']").val();
                            var lname = $("[name='lname']").val();
                            var email = $("[name='email']").val();
                            var phone = $("[name='phone']").val();
                            var address = $("[name='address']").val();
                            var city = $("[name='city']").val();
                            var state = $("[name='state']").val();
                            var country = $("[name='country']").val();
                            var pincode = $("[name='pincode']").val();
                            var token = $("[name='csrfmiddlewaretoken']").val();
                            
                            data = {
                                "fname": fname,
                                "lname": lname,
                                "email": email,
                                "phone": phone,
                                "address": address,
                                "city": city,
                                "state": state,
                                "country": country,
                                "pincode": pincode,
                                "payment_mode": "Cancelado con PayPal",
                                "payment_id": orderData.id,
                                csrfmiddlewaretoken: token
                            }
                            $.ajax({
                                method: "POST",
                                url: "/place-order",
                                data: data,
                                success: function (responsec){
                                    swal("Felicidades!", responsec.status , "success").then((value) => {
                                        window.location.href = '/my-orders'
                                    });
                                }
                            });
                    });
                }
            }).render('#paypal-button-container');
    </script>
    


    {% block scripts %}   

    {% endblock scripts %}

    {% comment  %} Razorpay checkout {% endcomment %}

    <script src="{% static '/js/checkout.js' %}"></script>


</body>
</html>